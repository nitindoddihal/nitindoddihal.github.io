from pptx import Presentation
from pptx.util import Inches, Pt
from pptx.enum.text import PP_ALIGN
from pptx.dml.color import RGBColor

# Create presentation
prs = Presentation()
prs.slide_width = Inches(10)
prs.slide_height = Inches(7.5)

def add_title_slide(title, subtitle):
    """Add a title slide"""
    slide = prs.slides.add_slide(prs.slide_layouts[6])  # Blank layout
    background = slide.background
    fill = background.fill
    fill.solid()
    fill.fore_color.rgb = RGBColor(30, 60, 114)  # Dark blue
    
    # Title
    title_box = slide.shapes.add_textbox(Inches(0.5), Inches(2.5), Inches(9), Inches(1.5))
    title_frame = title_box.text_frame
    title_frame.text = title
    title_frame.paragraphs[0].font.size = Pt(66)
    title_frame.paragraphs[0].font.bold = True
    title_frame.paragraphs[0].font.color.rgb = RGBColor(255, 255, 255)
    
    # Subtitle
    subtitle_box = slide.shapes.add_textbox(Inches(0.5), Inches(4.2), Inches(9), Inches(2))
    subtitle_frame = subtitle_box.text_frame
    subtitle_frame.word_wrap = True
    subtitle_frame.text = subtitle
    subtitle_frame.paragraphs[0].font.size = Pt(24)
    subtitle_frame.paragraphs[0].font.color.rgb = RGBColor(220, 220, 220)

def add_content_slide(title, sections):
    """Add a content slide with sections"""
    slide = prs.slides.add_slide(prs.slide_layouts[6])  # Blank
    background = slide.background
    fill = background.fill
    fill.solid()
    fill.fore_color.rgb = RGBColor(255, 255, 255)
    
    # Title
    title_box = slide.shapes.add_textbox(Inches(0.5), Inches(0.4), Inches(9), Inches(0.8))
    title_frame = title_box.text_frame
    title_frame.text = title
    title_frame.paragraphs[0].font.size = Pt(44)
    title_frame.paragraphs[0].font.bold = True
    title_frame.paragraphs[0].font.color.rgb = RGBColor(30, 60, 114)
    
    # Border under title
    line_shape = slide.shapes.add_shape(1, Inches(0.5), Inches(1.3), Inches(9), Inches(0))
    line_shape.line.color.rgb = RGBColor(42, 82, 152)
    line_shape.line.width = Pt(3)
    
    # Content
    y_position = 1.6
    for section_title, section_content in sections:
        # Section title
        section_box = slide.shapes.add_textbox(Inches(0.7), Inches(y_position), Inches(8.6), Inches(0.4))
        section_frame = section_box.text_frame
        section_frame.text = section_title
        section_frame.paragraphs[0].font.size = Pt(16)
        section_frame.paragraphs[0].font.bold = True
        section_frame.paragraphs[0].font.color.rgb = RGBColor(30, 60, 114)
        
        # Section content
        y_position += 0.45
        content_box = slide.shapes.add_textbox(Inches(0.9), Inches(y_position), Inches(8.4), Inches(1.2))
        content_frame = content_box.text_frame
        content_frame.word_wrap = True
        
        if isinstance(section_content, list):
            for i, item in enumerate(section_content):
                if i > 0:
                    content_frame.add_paragraph()
                p = content_frame.paragraphs[i]
                p.text = f"• {item}"
                p.font.size = Pt(13)
                p.font.color.rgb = RGBColor(70, 70, 70)
                p.space_before = Pt(3)
        else:
            content_frame.text = section_content
            content_frame.paragraphs[0].font.size = Pt(13)
            content_frame.paragraphs[0].font.color.rgb = RGBColor(70, 70, 70)
        
        y_position += 1.3

# SLIDE 1: Title
add_title_slide("IDEAL Framework", 
                "Transform Data into Executive Decisions\n\nA CoSTAR-Aligned Sequential Analysis Pipeline")

# SLIDE 2: Overview
slide = prs.slides.add_slide(prs.slide_layouts[6])
background = slide.background
fill = background.fill
fill.solid()
fill.fore_color.rgb = RGBColor(255, 255, 255)

title_box = slide.shapes.add_textbox(Inches(0.5), Inches(0.4), Inches(9), Inches(0.8))
title_frame = title_box.text_frame
title_frame.text = "The IDEAL Framework"
title_frame.paragraphs[0].font.size = Pt(44)
title_frame.paragraphs[0].font.bold = True
title_frame.paragraphs[0].font.color.rgb = RGBColor(30, 60, 114)

line_shape = slide.shapes.add_shape(1, Inches(0.5), Inches(1.3), Inches(9), Inches(0))
line_shape.line.color.rgb = RGBColor(42, 82, 152)
line_shape.line.width = Pt(3)

# Subtitle
subtitle_box = slide.shapes.add_textbox(Inches(0.7), Inches(1.6), Inches(8.6), Inches(0.6))
subtitle_frame = subtitle_box.text_frame
subtitle_frame.word_wrap = True
subtitle_frame.text = "A four-stage pipeline that guides data analysis from intent to action, removing one layer of abstraction at each step."
subtitle_frame.paragraphs[0].font.size = Pt(14)
subtitle_frame.paragraphs[0].font.color.rgb = RGBColor(100, 100, 100)

# Stage boxes
stages = [
    ("1", "Identify &\nImport", "Intent + Data\nIntegrity", RGBColor(102, 126, 234)),
    ("2", "Describe &\nDiscover", "Understand\nLandscape", RGBColor(240, 147, 251)),
    ("3", "Explore &\nExamine", "Surface\nPatterns", RGBColor(79, 172, 254)),
    ("4", "Analyze &\nApply", "Transform into\nInsights", RGBColor(67, 233, 123))
]

x = 0.5
for i, (num, stage_name, subtitle, color) in enumerate(stages):
    # Box
    box = slide.shapes.add_shape(1, Inches(x), Inches(2.8), Inches(2), Inches(1.8))
    box.fill.solid()
    box.fill.fore_color.rgb = color
    box.line.color.rgb = color
    
    # Number
    num_box = slide.shapes.add_textbox(Inches(x + 0.1), Inches(2.95), Inches(1.8), Inches(0.5))
    num_frame = num_box.text_frame
    num_frame.text = num
    num_frame.paragraphs[0].font.size = Pt(48)
    num_frame.paragraphs[0].font.bold = True
    num_frame.paragraphs[0].font.color.rgb = RGBColor(255, 255, 255)
    
    # Stage name
    name_box = slide.shapes.add_textbox(Inches(x + 0.1), Inches(3.5), Inches(1.8), Inches(0.8))
    name_frame = name_box.text_frame
    name_frame.word_wrap = True
    name_frame.text = stage_name
    name_frame.paragraphs[0].font.size = Pt(13)
    name_frame.paragraphs[0].font.bold = True
    name_frame.paragraphs[0].font.color.rgb = RGBColor(255, 255, 255)
    
    # Subtitle
    sub_box = slide.shapes.add_textbox(Inches(x + 0.1), Inches(4.35), Inches(1.8), Inches(0.9))
    sub_frame = sub_box.text_frame
    sub_frame.word_wrap = True
    sub_frame.text = subtitle
    sub_frame.paragraphs[0].font.size = Pt(10)
    sub_frame.paragraphs[0].font.color.rgb = RGBColor(255, 255, 255)
    
    x += 2.3

# SLIDE 3: Stage 1
add_content_slide("Stage 1: Identify & Import", [
    ("Objective", "Clearly define the analysis intent, confirm successful data import, and establish a Learning Agenda that guides subsequent analysis."),
    ("Key Activities", [
        "Confirm data import and readability",
        "Identify tables, fields, and schema",
        "Validate structure supports key analyses",
        "State primary analysis goal (1 sentence)",
        "Create Learning Agenda (5–8 key business questions)"
    ]),
    ("Constraint", "⚠ No data analysis or insights. Intent-setting only."),
])

# SLIDE 4: Stage 2
add_content_slide("Stage 2: Describe & Discover", [
    ("Objective", "Describe the structure, contents, and quality of the dataset to ensure it is fit for analysis and surface early patterns and anomalies."),
    ("Key Activities", [
        "List all columns with data types",
        "Display 5+ random sample rows",
        "Perform data quality checks",
        "Summarise structural observations",
        "Frame exploratory questions (not insights)"
    ]),
    ("Constraint", "⚠ No aggregation, modelling, or KPI calculations. Description only."),
])

# SLIDE 5: Stage 3
add_content_slide("Stage 3: Explore & Examine", [
    ("Objective", "Explore the dataset to identify patterns, relationships, and early signals, and generate testable hypotheses—without drawing final conclusions."),
    ("Key Activities", [
        "Examine relationships across revenue, growth, churn",
        "Highlight correlations, contrasts, and patterns",
        "Generate clear, testable hypotheses",
        "List questions data can answer vs. blocked by missing data",
        "Suggest additional datasets (do not merge unless instructed)"
    ]),
    ("Constraint", "⚠ No forecasting, modelling, or recommendations. Hypotheses are provisional."),
])

# SLIDE 6: Stage 4
add_content_slide("Stage 4: Analyze & Apply", [
    ("Objective", "Analyse the dataset to produce clear, decision-relevant insights through cleaning, summarisation, and visualisation—for CEO consumption."),
    ("Key Activities", [
        "Perform data wrangling (clean, format)",
        "Generate statistical summaries",
        "Create clear visualisations (charts, graphs, dashboards)",
        "Apply the 5-second rule to every output",
        "Link each insight to the Learning Agenda"
    ]),
    ("Now Permitted", "✓ Analysis, statistical summaries, visualisations. Still Restricted: Predictive modelling (unless requested)."),
])

# SLIDE 7: CoSTAR Framework
slide = prs.slides.add_slide(prs.slide_layouts[6])
background = slide.background
fill = background.fill
fill.solid()
fill.fore_color.rgb = RGBColor(255, 255, 255)

title_box = slide.shapes.add_textbox(Inches(0.5), Inches(0.4), Inches(9), Inches(0.8))
title_frame = title_box.text_frame
title_frame.text = "The CoSTAR Framework"
title_frame.paragraphs[0].font.size = Pt(44)
title_frame.paragraphs[0].font.bold = True
title_frame.paragraphs[0].font.color.rgb = RGBColor(30, 60, 114)

line_shape = slide.shapes.add_shape(1, Inches(0.5), Inches(1.3), Inches(9), Inches(0))
line_shape.line.color.rgb = RGBColor(42, 82, 152)
line_shape.line.width = Pt(3)

# CoSTAR boxes
costar_items = [
    ("Context", "Set the scene, background info"),
    ("Objective", "State exactly what AI should achieve"),
    ("Steps", "Break down into sequential steps"),
    ("Tools", "Specify available resources"),
    ("Actions", "Define expected output format"),
    ("Reflection", "Build in self-check")
]

y = 1.8
for title, desc in costar_items:
    # Box background
    box = slide.shapes.add_shape(1, Inches(0.7), Inches(y), Inches(8.6), Inches(0.65))
    box.fill.solid()
    box.fill.fore_color.rgb = RGBColor(240, 244, 248)
    box.line.color.rgb = RGBColor(42, 82, 152)
    box.line.width = Pt(1)
    
    # Title
    title_box = slide.shapes.add_textbox(Inches(0.85), Inches(y + 0.08), Inches(2), Inches(0.3))
    title_frame = title_box.text_frame
    title_frame.text = title
    title_frame.paragraphs[0].font.size = Pt(14)
    title_frame.paragraphs[0].font.bold = True
    title_frame.paragraphs[0].font.color.rgb = RGBColor(30, 60, 114)
    
    # Description
    desc_box = slide.shapes.add_textbox(Inches(3), Inches(y + 0.08), Inches(5.5), Inches(0.5))
    desc_frame = desc_box.text_frame
    desc_frame.word_wrap = True
    desc_frame.text = desc
    desc_frame.paragraphs[0].font.size = Pt(12)
    desc_frame.paragraphs[0].font.color.rgb = RGBColor(70, 70, 70)
    
    y += 0.75

# SLIDE 8: Summary Table
slide = prs.slides.add_slide(prs.slide_layouts[6])
background = slide.background
fill = background.fill
fill.solid()
fill.fore_color.rgb = RGBColor(255, 255, 255)

title_box = slide.shapes.add_textbox(Inches(0.5), Inches(0.4), Inches(9), Inches(0.8))
title_frame = title_box.text_frame
title_frame.text = "IDEAL Pipeline at a Glance"
title_frame.paragraphs[0].font.size = Pt(44)
title_frame.paragraphs[0].font.bold = True
title_frame.paragraphs[0].font.color.rgb = RGBColor(30, 60, 114)

line_shape = slide.shapes.add_shape(1, Inches(0.5), Inches(1.3), Inches(9), Inches(0))
line_shape.line.color.rgb = RGBColor(42, 82, 152)
line_shape.line.width = Pt(3)

# Create table
rows, cols = 5, 5
left = Inches(0.5)
top = Inches(1.6)
width = Inches(9)
height = Inches(4.8)

table_shape = slide.shapes.add_table(rows, cols, left, top, width, height)
table = table_shape.table

# Header row
headers = ["Stage", "Mindset", "Activity", "Output", "Constraint"]
for i, header in enumerate(headers):
    cell = table.cell(0, i)
    cell.text = header
    cell.fill.solid()
    cell.fill.fore_color.rgb = RGBColor(30, 60, 114)
    for paragraph in cell.text_frame.paragraphs:
        for run in paragraph.runs:
            run.font.bold = True
            run.font.size = Pt(11)
            run.font.color.rgb = RGBColor(255, 255, 255)

# Data rows
data = [
    ["Identify & Import", "Permission", "Define intent + validate", "Learning Agenda", "No analysis"],
    ["Describe & Discover", "Understanding", "Schema review + QC", "Data fitness report", "No aggregation"],
    ["Explore & Examine", "Hypothesis", "Pattern + correlation", "Testable hypotheses", "No forecasting"],
    ["Analyze & Apply", "Action", "Cleaning + summaries", "CEO-ready insights", "No baseless recs"]
]

for row_idx, row_data in enumerate(data, 1):
    for col_idx, cell_text in enumerate(row_data):
        cell = table.cell(row_idx, col_idx)
        cell.text = cell_text
        if row_idx % 2 == 0:
            cell.fill.solid()
            cell.fill.fore_color.rgb = RGBColor(249, 249, 249)
        for paragraph in cell.text_frame.paragraphs:
            for run in paragraph.runs:
                run.font.size = Pt(10)
                run.font.color.rgb = RGBColor(70, 70, 70)

# SLIDE 9: Best Practices
add_content_slide("Best Practices & Tips", [
    ("✓ Do", [
        "Respect stage boundaries—don't skip or jump ahead",
        "Make constraints explicit in every prompt",
        "Include reflection/self-check at the end of each stage",
        "Frame outputs for the CEO (clarity over completeness)",
        "Document assumptions and data gaps transparently"
    ]),
    ("✗ Don't", [
        "Create visualisations before understanding data quality",
        "Draw conclusions without surfacing patterns first",
        "Assume data gaps can be ignored—flag them early",
        "Use jargon or technical language for executive outputs",
        "Merge new datasets without explicit approval"
    ]),
])

# SLIDE 10: Closing
add_title_slide("Ready to Transform Data into Decisions",
                "Use IDEAL + CoSTAR to run your SaaS analytics pipeline\nwith rigor and clarity.\n\nStart with Stage 1 • Move sequentially • Deliver CEO-ready insights by Stage 4")

# Save presentation
prs.save('IDEAL_Framework_CoSTAR.pptx')
print("✓ PowerPoint file created: IDEAL_Framework_CoSTAR.pptx")
print("Ready to download!")
